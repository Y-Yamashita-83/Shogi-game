# エクストリーム将棋

## このゲームについて

### 概要

- Pygameを使用した将棋ゲームで、通常の将棋ルールに加えて「特殊技」システムが実装されています。
- このゲームのコードは、すべてAmazon Q Developer CLI の q chatを使用して書かれています。
- 本READMEも、一部を除きAmazon Q Developer CLI の q chatを使用して書かれています。

### 音楽
このゲームの音楽は「MOMIZizm MUSiC（もみじば）」様のフリーBGMを使用しています。
https://music.storyinvention.com/

### 動作確認環境
このゲームは、以下の環境で動作確認済みです。

- Windows11
- Python 3.12.4
- pygame 2.6.1

## 機能

### 基本機能
- 将棋盤と駒の表示（画像表示対応）
- 各駒の正確な動きのルール実装
- 駒の選択と移動（移動可能なマスがハイライト表示）
- 駒を取る機能
- 成り（駒の昇格）機能と成るかどうかの選択
- 持ち駒を打つ機能
- 王手と詰みの判定
- 手番の交代
- ゲーム終了条件（詰みまたは王・玉の取得）
- ゲーム終了時のリスタート機能

### 特殊技システム
- **メンコ**: ランダムに3枚の駒を裏返す（成り/元に戻す）
- **突風**: 駒を吹き飛ばす効果
- **変化の杖**: 駒を変化させる
- **転送装置**: 駒の位置を転送
- **駒落ち**: 駒を盤面から除去
- 各特殊技は1ゲームにつき1回のみ使用可能

### AI機能
- 高度な戦術パターン認識（フォーク、ピン、スキュワーなど）
- 複数の難易度レベル
- 特殊技の戦略的使用判断
- 局面評価システム

### 音響・視覚効果
- 駒の移動・配置時の効果音
- 各特殊技専用の音声
- BGM再生機能
- メッセージエフェクト表示
- ハイライトエフェクト

### ゲームモード
- 通常対局モード
- 終盤練習モード（ランダム終盤配置）

## コード構造

### ディレクトリ構成
```
shogi_game/
├── main.py              # メインエントリーポイント
├── board.py             # 将棋盤とゲームロジック
├── pieces.py            # 駒クラスの定義
├── special_moves.py     # 特殊技システム
├── ai.py                # AIプレイヤー
├── constants.py         # 定数定義
├── utils.py             # ユーティリティ関数
├── event_manager.py     # イベント管理システム
├── bgm_manager.py       # BGM管理
├── ui/                  # UI関連
│   ├── windows.py       # ウィンドウ（特殊技、成り判定）
│   ├── button.py        # ボタンコンポーネント
│   └── effect_display.py # エフェクト表示
└── assets/              # リソースファイル
    ├── images/          # 画像ファイル
    │   ├── koma/        # 駒の画像
    │   ├── title/       # タイトル画像
    │   └── battle/      # バトル関連画像
    └── sound/           # 音声ファイル
        ├── bgm/         # BGM
        └── voice/       # 音声
```

### 主要ファイルの役割

#### main.py - メインエントリーポイント
- ゲームの初期化とメインループ
- ゲームモード選択（通常モード、終盤モード）
- 各コンポーネントの統合
- イベント処理とゲーム状態管理
- BGM再生制御

#### board.py - 将棋盤とゲームロジック
- 将棋盤の描画と管理
- 駒の移動ロジック
- 王手・詰み判定
- 持ち駒システム
- 成り判定
- 特殊技の効果適用
- エフェクト表示管理

#### pieces.py - 駒クラス
- 各駒の定義（歩、香、桂、銀、金、王、角、飛）
- 駒の移動ルール
- 成り駒の処理
- 特殊効果の状態管理（`effects`辞書）
- 駒の描画（画像またはテキスト）

#### special_moves.py - 特殊技システム
- 特殊技の基底クラス`SpecialMove`
- 各特殊技の実装（メンコ、突風、変化の杖、転送装置、駒落ち）
- 使用条件と効果の定義
- 特殊技の使用状態管理

#### ai.py - AIプレイヤー
- `TacticsEngine`: 戦術パターン認識エンジン
- フォーク、ピン、スキュワーなどの戦術評価
- 局面評価システム
- 特殊技の使用判断
- 複数の難易度レベル

#### UI関連ファイル
- **windows.py**: 特殊技選択ウィンドウ、成り判定ウィンドウ
- **button.py**: ボタンコンポーネント
- **effect_display.py**: メッセージエフェクト、ハイライトエフェクト

#### システム管理ファイル
- **event_manager.py**: イベント駆動システム
- **bgm_manager.py**: BGM再生管理
- **constants.py**: 画面サイズ、色定義などの定数
- **utils.py**: 画像読み込み、フォント設定などのユーティリティ

### 特殊技システムの設計

1. **使用制限**: 各特殊技は1回のゲームで1度だけ使用可能
2. **効果の多様性**: 駒の状態変更、位置移動、除去など様々な効果
3. **視覚的フィードバック**: エフェクト表示とメッセージ
4. **音声対応**: 各特殊技に専用の音声ファイル
## 実行方法


```
python3 main.py
```

## 操作方法

### 基本操作
- 盤上の駒をクリックして選択
- 持ち駒をクリックして選択
  - 先手の持ち駒：画面左側（左上から配置、1行2駒まで）
  - 後手の持ち駒：画面右側（右下から配置、1行2駒まで）
- 緑色にハイライトされた移動可能なマスをクリックして駒を移動または持ち駒を打つ
- 敵陣3段目に入ると成りの選択ウィンドウが表示される
  - 「成る」または「成らない」を選択

### 特殊技の使用方法
- 画面右上の「技を使う」ボタンをクリックすると特殊技ウィンドウが開きます
- 使用したい特殊技を選択し、「使う」ボタンをクリック
- 対象が必要な技の場合は、対象の駒または位置をクリック
- 特殊技ウィンドウの「戻る」ボタンをクリックすると元の画面に戻ります
- 各特殊技は1ゲームにつき1回のみ使用可能

### ゲーム終了
- 王手の場合は画面上部に「王手！！」と表示
- ゲーム終了条件：
  - 詰みの場合：画面上部に「詰み！！〇〇の勝ち！！」と表示
  - 王または玉が取られた場合：画面上部に「〇〇の勝ち！！」と表示
  - ゲーム終了時は画面下部に「最初に戻る」ボタンが表示され、クリックすると新しいゲームが始まります

## 特殊技詳細

### 利用可能な特殊技

#### メンコ
- **効果**: ランダムに3枚の駒を裏返す（成っていない駒は成り、成っている駒は元に戻る）
- **対象**: 王と金以外の駒
- **使用条件**: 盤上に対象となる駒が3枚以上存在すること

#### 突風
- **効果**: 指定した駒を吹き飛ばして移動させる
- **対象**: 任意の駒
- **使用条件**: 常時使用可能

#### 変化の杖
- **効果**: 指定した駒を別の種類の駒に変化させる
- **対象**: 任意の駒
- **使用条件**: 常時使用可能

#### 転送装置
- **効果**: 指定した駒を別の位置に転送する
- **対象**: 任意の駒
- **使用条件**: 常時使用可能

#### 駒落ち
- **効果**: 指定した駒を盤面から除去する
- **対象**: 任意の駒
- **使用条件**: 常時使用可能

### 特殊技の戦略的活用
- 各特殊技は1ゲームにつき1回のみ使用可能なため、タイミングが重要
- AIも特殊技を戦略的に使用するため、対抗策を考える必要がある
- 特殊技の効果音と視覚エフェクトで効果を確認できる

## 持ち駒のルール

- 持ち駒は空きマスにのみ打てます
- 歩と香車は1段目（後手は9段目）に打てません
- 桂馬は1、2段目（後手は8、9段目）に打てません
- 二歩（同じ筋に自分の歩が既にある場合）は禁止です

## 駒の動き

- 歩兵（歩）：前に1マス
  - 先手：下に1マス
  - 後手：上に1マス
- 香車（香）：前に何マスでも
  - 先手：下方向
  - 後手：上方向
- 桂馬（桂）：前に2マス、横に1マス（L字）
  - 先手：下に2マス、横に1マス
  - 後手：上に2マス、横に1マス
- 銀将（銀）：斜め前3方向と斜め後ろ2方向
  - 先手：下斜め3方向と上斜め2方向
  - 後手：上斜め3方向と下斜め2方向
- 金将（金）：前後左右と斜め前（6方向）
  - 先手：上下左右と下斜め2方向
  - 後手：上下左右と上斜め2方向
- 王将/玉将（王/玉）：周囲8マス
- 角行（角）：斜め方向に何マスでも
- 飛車（飛）：縦横方向に何マスでも

## 成り駒

- 歩兵 → と金（金と同じ動き）
- 香車 → 成香（金と同じ動き）
- 桂馬 → 成桂（金と同じ動き）
- 銀将 → 成銀（金と同じ動き）
- 角行 → 馬（角の動き + 十字1マス）
- 飛車 → 龍（飛車の動き + 斜め1マス）

## 技術仕様

### 必要な環境
- Python 3.x
- Pygame ライブラリ

### アーキテクチャの特徴
- **イベント駆動設計**: `EventManager`による疎結合なコンポーネント間通信
- **モジュラー設計**: 各機能が独立したモジュールとして実装
- **拡張可能な特殊技システム**: 新しい特殊技を簡単に追加可能
- **高度なAI**: 戦術パターン認識と局面評価を組み合わせた強力なAI
- **リソース管理**: 画像、音声ファイルの効率的な管理

### パフォーマンス最適化
- 画像の事前読み込みとキャッシュ
- エフェクトシステムの効率的な更新
- AI思考時間の調整機能

## 開発・拡張について

### 新しい特殊技の追加方法
1. `special_moves.py`に新しいクラスを作成
2. `SpecialMove`基底クラスを継承
3. `can_use()`と`execute()`メソッドを実装
4. `get_special_moves()`関数に追加

### カスタマイズ可能な要素
- 駒の画像（`assets/images/koma/`）
- BGMと効果音（`assets/sound/`）
- 画面サイズと色設定（`constants.py`）
- AI の難易度設定（`ai.py`）

## 注意点

このゲームでは、以下の機能は実装されていません：

- 千日手や持将棋などの特殊なルール
- ネットワーク対戦機能
- 棋譜の保存・読み込み機能